-- LocalScript (วางใน StarterGui)
-- ใส่ภาพไอคอนของผู้ใช้: ใช้รูปจาก ID ที่ให้มา
local ICON_ASSET_ID = "rbxassetid://113198415304041"

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- สร้าง ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ToggleIconGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- ====== ไอคอนเล็ก (ปุ่ม) ======
local iconButton = Instance.new("ImageButton")
iconButton.Name = "MiniIcon"
iconButton.Parent = screenGui
iconButton.AnchorPoint = Vector2.new(0, 0)
iconButton.Position = UDim2.new(0, 20, 0, 20) -- ปรับตำแหน่งเริ่มต้นที่มุมซ้ายบน
iconButton.Size = UDim2.new(0, 48, 0, 48)
iconButton.Image = ICON_ASSET_ID
iconButton.BackgroundTransparency = 1
iconButton.ZIndex = 10
iconButton.ImageRectOffset = Vector2.new(0,0)
iconButton.ImageRectSize = Vector2.new(0,0)

-- สร้างขอบวงกลม/เอฟเฟกต์ (optional)
local iconFrame = Instance.new("Frame")
iconFrame.Name = "IconFrame"
iconFrame.Parent = iconButton
iconFrame.AnchorPoint = Vector2.new(0.5, 0.5)
iconFrame.Position = UDim2.fromScale(0.5, 0.5)
iconFrame.Size = UDim2.new(1, 0, 1, 0)
iconFrame.BackgroundTransparency = 0.6
iconFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
iconFrame.BorderSizePixel = 0
iconFrame.ZIndex = 9
iconFrame.ClipsDescendants = true
iconFrame.Visible = false -- ซ่อนถ้าไม่ต้องการ

-- ====== GUI หลัก ที่จะโชว์/ซ่อน ======
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainWindow"
mainFrame.Parent = screenGui
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.Size = UDim2.new(0, 420, 0, 260)
mainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.ZIndex = 9
mainFrame.ClipsDescendants = true
mainFrame.BackgroundTransparency = 0

-- หัวเรื่อง
local title = Instance.new("TextLabel")
title.Name = "Title"
title.Parent = mainFrame
title.Size = UDim2.new(1, -16, 0, 36)
title.Position = UDim2.new(0, 8, 0, 8)
title.BackgroundTransparency = 1
title.Text = "My GUI"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left

-- ปุ่มปิด
local closeButton = Instance.new("TextButton")
closeButton.Name = "Close"
closeButton.Parent = mainFrame
closeButton.Size = UDim2.new(0, 36, 0, 28)
closeButton.Position = UDim2.new(1, -44, 0, 8)
closeButton.BackgroundTransparency = 0.2
closeButton.BackgroundColor3 = Color3.fromRGB(200,40,40)
closeButton.BorderSizePixel = 0
closeButton.Text = "X"
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 16
closeButton.TextColor3 = Color3.fromRGB(255,255,255)

-- เนื้อหา (ตัวอย่าง)
local contentLabel = Instance.new("TextLabel")
contentLabel.Name = "Content"
contentLabel.Parent = mainFrame
contentLabel.Size = UDim2.new(1, -16, 1, -60)
contentLabel.Position = UDim2.new(0, 8, 0, 52)
contentLabel.BackgroundTransparency = 1
contentLabel.Text = "นี่คือตัวอย่าง GUI ของคุณ\nใส่เนื้อหาอื่นๆ ได้ที่นี่"
contentLabel.TextColor3 = Color3.fromRGB(230,230,230)
contentLabel.Font = Enum.Font.Gotham
contentLabel.TextSize = 16
contentLabel.TextWrapped = true
contentLabel.TextYAlignment = Enum.TextYAlignment.Top

-- ====== ตัวอย่างแสดงรูป avatar ด้านใน GUI (ใช้เดียวกับไอคอน) ======
local avatarImg = Instance.new("ImageLabel")
avatarImg.Name = "Avatar"
avatarImg.Parent = mainFrame
avatarImg.Size = UDim2.new(0, 64, 0, 64)
avatarImg.Position = UDim2.new(0, 8, 0, 44)
avatarImg.Image = ICON_ASSET_ID
avatarImg.BackgroundTransparency = 1
avatarImg.ZIndex = 11

-- ====== ฟังก์ชันการสลับ GUI ======
local function toggleMain()
    mainFrame.Visible = not mainFrame.Visible
    if mainFrame.Visible then
        -- tween เล็กน้อยเวลาเปิด
        mainFrame.Position = UDim2.new(0.5, 0, -0.2, 0)
        local t = TweenService:Create(mainFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(0.5, 0, 0.5, 0)})
        t:Play()
    else
        -- ปิดด้วย tween ย่อ
        local t2 = TweenService:Create(mainFrame, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Position = UDim2.new(0.5, 0, -0.2, 0)})
        t2:Play()
        t2.Completed:Wait()
        mainFrame.Visible = false
    end
end

iconButton.MouseButton1Click:Connect(toggleMain)
closeButton.MouseButton1Click:Connect(function()
    -- ปิดโดยตรง
    local t2 = TweenService:Create(mainFrame, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Position = UDim2.new(0.5, 0, -0.2, 0)})
    t2:Play()
    t2.Completed:Wait()
    mainFrame.Visible = false
end)

-- ====== ทำให้ไอคอนลากได้ (รองรับเมาส์และทัช) ======
local dragging = false
local dragStart = nil
local startPos = nil
local inputConnection
local moveConnection

local function onInputBegan(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = iconButton.Position

        inputConnection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                if inputConnection then inputConnection:Disconnect(); inputConnection = nil end
                if moveConnection then moveConnection:Disconnect(); moveConnection = nil end
            end
        end)

        moveConnection = UserInputService.InputChanged:Connect(function(moveInput)
            if not dragging then return end
            if moveInput.UserInputType == Enum.UserInputType.MouseMovement or moveInput.UserInputType == Enum.UserInputType.Touch then
                local delta = moveInput.Position - dragStart
                local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)

                -- จำกัดให้อยู่ในหน้าจอ (padding เท่ากับ icon size)
                local screenW, screenH = workspace.CurrentCamera.ViewportSize.X, workspace.CurrentCamera.ViewportSize.Y
                local iconW, iconH = iconButton.AbsoluteSize.X, iconButton.AbsoluteSize.Y
                local x = math.clamp(newPos.X.Offset, 0, screenW - iconW)
                local y = math.clamp(newPos.Y.Offset, 0, screenH - iconH)

                iconButton.Position = UDim2.new(0, x, 0, y)
            end
        end)
    end
end

iconButton.InputBegan:Connect(onInputBegan)

-- รองรับการกดคีย์เพื่อเปิด/ปิด (เช่นปุ่ม I)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.I then
        toggleMain()
    end
end)

-- ====== หมายเหตุ: ถ้าภาพไม่ขึ้น ======
-- หากรูปจาก ID ถูกบล็อกหรือไม่ใช่รูปที่เป็น decal/public อาจไม่สามารถแสดงได้
-- ถ้าอยากเปลี่ยน ID ให้แก้ตัวแปร ICON_ASSET_ID ด้านบนเป็น "rbxassetid://NEW_ID"
